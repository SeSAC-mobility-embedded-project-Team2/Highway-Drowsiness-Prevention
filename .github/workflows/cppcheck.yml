name: Cppcheck HTML Report

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 저장소 코드 가져오기
      - uses: actions/checkout@v4

      # 2. 파일이 제대로 받아졌는지 확인 (디버깅용)
      # 만약 여기서 파일 목록이 안 나온다면 checkout 문제임
      - name: Check files
        run: ls -R

      # 3. Cppcheck 설치
      - name: Install Cppcheck
        run: |
          sudo apt-get update
          sudo apt-get install -y cppcheck

      # 4. 분석 실행 및 HTML 변환
      # 수정사항: 점(.) 대신 "${{ github.workspace }}" 절대 경로 사용
      - name: Generate Report
        run: |
          cppcheck --enable=all --inconclusive --xml --xml-version=2 "${{ github.workspace }}" 2> report.xml
          cppcheck-htmlreport --file=report.xml --report-dir=html_report --source-dir="${{ github.workspace }}" --title="Cppcheck Report"

      # 5. 결과물 업로드
      - name: Upload HTML Report
        uses: actions/upload-artifact@v4
        with:
          name: cppcheck-html-report
          path: html_report
